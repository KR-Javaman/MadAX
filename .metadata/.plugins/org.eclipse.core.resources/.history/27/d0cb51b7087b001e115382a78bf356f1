package com.javaman.madax.shorts.controller;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import com.javaman.madax.shorts.service.BasicService;

import lombok.RequiredArgsConstructor;

@Controller
@RequiredArgsConstructor
@RequestMapping("shorts")
public class BasicController {

	private final BasicService service;
	
	   @GetMapping("video")
	    public String basic() {
	        return "shorts-main";
	    }
	
//	@PostMapping("video")
//	@ResponseBody
//	public String saveFile(@RequestParam("shortsVideo") MultipartFile shortsVideo,
//			@RequestParam("desc") String description) {
//		
//		service.saveFile(shortsVideo);
//		
//		return "업로드 성공!! - 파일 이름: " + shortsVideo.getOriginalFilename() + ", 파일 설명: " + description;
//	}
	
	
	@PostMapping("video")
	@ResponseBody
	public ResponseEntity<String> saveFile(@RequestParam("shortsVideo") MultipartFile shortsVideo,
										@RequestParam("chunkNumber") int chunkNumber,
										@RequestParam("totalChunks") int totalChunks){
		
		boolean isDone = service.saveFile(shortsVideo,chunkNumber, totalChunks);
		return isDone ? ResponseEntity.ok("Upload Success") : 
						ResponseEntity.status(HttpStatus.PARTIAL_CONTENT).build();
	}
	
	
}
