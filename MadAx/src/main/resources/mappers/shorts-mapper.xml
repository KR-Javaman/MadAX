<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- 연결할 인터페이스의 패키지명.인터페이스명으로 작성 -->
<mapper namespace="com.javaman.madax.shorts.model.mapper.ShortsMapper">
  
  	<resultMap id="video_rm" type="VIDEO">
		
		<id property="boardVideoNo" column="BOARD_VIDEO_NO" />
				
	</resultMap>
  
  
  
  
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM "VIDEO_BOARD"
		WHERE VIDEO_DEL_FL = 'N'
	</select>
	
	<select id="selectList" resultType="VideoBoard">
		SELECT BOARD_VIDEO_NO, VIDEO_TITLE, VIDEO_PATH, VIDEO_RENAME,
			(SELECT COUNT(*) FROM "VIDEO_LIKE" L
			WHERE L.MEMBER_NO  = B.MEMBER_NO  ) LIKE_COUNT
		FROM "VIDEO_BOARD" B
		JOIN "VIDEO" USING(BOARD_VIDEO_NO)
		WHERE VIDEO_DEL_FL ='N'
		ORDER BY BOARD_VIDEO_NO DESC
	</select>

	<insert id="writeInsert" useGeneratedKeys="true">
		<selectKey order="BEFORE" resultType="_int" keyProperty="boardVideoNo" >
        	SELECT SEQ_BOARD_VIDEO_NO.NEXTVAL FROM DUAL
      	</selectKey>
      INSERT INTO "VIDEO_BOARD"
      VALUES( #{boardVideoNo} , #{videoTitle},  #{videoContent},
         DEFAULT, DEFAULT, DEFAULT, #{memberNo})
	</insert>
	
	<insert id="uploadVideoFile" parameterType="list">
		INSERT INTO "VIDEO"
			VALUES(SEQ_VIDEO_NO(),
				   #{videoPath},
				   #{videoRename},
				   #{videoOrder},
				   #{boardVideoNo},
				   #{videoOriginalName}
				   )
	   		
	</insert>
	
	<insert id="videoInsert">
		INSERT INTO "VIDEO"
		VALUES(SEQ_VIDEO_NO.NEXTVAL,
				   #{videoPath},
				   #{videoRename},
				   #{videoOrder},
				   #{boardVideoNo},
				   #{videoOriginalName})
	</insert>
	
	<select id="selectVideo" resultType="_int">
		SELECT SEQ_VIDEO_NO.NEXTVAL, #{videoPath},
			   #{videoRename},
			   #{videoOrder},
			   #{boardVideoNo},
			   #{videoOriginalName}
		FROM VIDEO
	</select>


	<select id="videoBoardDetail" resultMap="video_rm">
		SELECT BOARD_VIDEO_NO, VIDEO_TITLE, VIDEO_CONTENT, VIDEO_READCOUNT, VIDEO_NO,
			TO_CHAR(VIDEO_WRITE_DATE, 'YYYY"년" MM"월" DD"일" HH24:MI:SS') VIDEO_WRITE_DATE,
			TO_CHAR(VIDEO_UPDATE_DATE, 'YYYY"년" MM"월" DD"일" HH24:MI:SS') VIDEO_UPDATE_DATE,
			MEMBER_NICKNAME, PROFILE_IMG, MEMBER_NO,
			
			(SELECT COUNT(*) FROM "VIDEO_LIKE" L 
			WHERE L.BOARD_VIDEO_NO = B.BOARD_VIDEO_NO) LIKE_COUNT
			
		FROM "VIDEO_BOARD" B
		JOIN "MEMBER" USING(MEMBER_NO)
		JOIN "VIDEO" USING(BOARD_VIDEO_NO)
		WHERE VIDEO_DEL_FL = 'N'
		AND VIDEO_NO = #{videoNo}
	</select>
	
	<select id="likeCLick" resultType="_int">
		SELECT COUNT(*) FROM "VIDEO_LIKE"
		WHERE BOARD_VIDEO_NO = #{boardVideoNo}
		AND MEMBER_NO = #{memberNo}
	</select>
	
	<update id="readCount">
		UPDATE "VIDEO_BOARD" SET
		VIDEO_READCOUNT = VIDEO_READCOUNT + 1
		WHERE BOARD_VIDEO_NO = #{boardVideoNo}
	</update>
	
	
</mapper>